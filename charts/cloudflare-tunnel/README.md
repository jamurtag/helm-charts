# Cloudflare Tunnel

[Cloudflare Tunnel](https://www.cloudflare.com/products/tunnel/) is used to establish inside-out connectivity to Cloudflare to securely proxy traffic to internal services.

## Installing the Chart

Before you can install the chart you will need to add the `jamurtag` repo to [Helm](https://helm.sh/).

```shell
helm repo add jamurtag https://jamurtag.github.io/helm-charts/
```

After you've installed the repo you can install the chart.

```shell
helm upgrade --install --namespace default --values ./my-values.yaml my-release jamurtag/cloudflare-tunnel
```

## Prerequisites

The chart relies on a Kubernetes secret that is passed via the `secretName` value (defaults to `cloudflare-tunnel`).

To create the secret, create a `credentials.json` file, or use the file generated by the [cloudflare tunnel create](https://developers.cloudflare.com/cloudflare-one/tutorials/many-cfd-one-tunnel/)):

```json
{
  "AccountTag": "<account_id>",
  "TunnelID": "<tunnel_id>",
  "TunnelName": "<tunnel_name>",
  "TunnelSecret": "<tunnel_secret>"
}
```

Then deploy it to the namespace that will host the tunnel:

```shell
kubectl create secret generic cloudflare-tunnel --namespace=default \
    --from-file=credentials.json=<path_to_generated_file>
```